# Copyright Envoy AI Gateway Authors
# SPDX-License-Identifier: Apache-2.0
# The full text of the Apache license is available in the LICENSE file at
# the root of the repo.

# This file contains the RBAC roles and role bindings for the Envoy Gateway
# so that it can read the InferencePool resources that are set in the HTTPRoutes
# generated by the AI Gateway.
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: {{ include "ai-gateway-helm.inference-pool.clusterRoleName" . }}
rules:
  - apiGroups:
      - "inference.networking.k8s.io"
    resources:
      - "inferencepools"
    verbs:
      - "get"
      - "list"
      - "watch"
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: {{ include "ai-gateway-helm.inference-pool.clusterRoleBindingName" . }}
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: {{ include "ai-gateway-helm.inference-pool.clusterRoleName" . }}
subjects:
  - kind: ServiceAccount
    # The service account name is hardcoded to "envoy-gateway":
    # https://github.com/envoyproxy/gateway/blob/70af785fba094929bc6044a57470d429205c4d5e/charts/gateway-helm/templates/envoy-gateway-serviceaccount.yaml#L4
    name: envoy-gateway
    namespace: {{ .Values.envoyGateway.namespace }}
---
